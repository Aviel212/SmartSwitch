

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title></title>
    <script src="scripts/jquery.js"></script>
    <link href="styles/w3css.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css">
    <script src="scripts/SmartSwitchJavaScriptAPI.js"></script>
</head>
<body>
    <div id="main-div">

        <h4><u>Settings page of device:</u></h4>
        <table>
            <tr>
                <td><p>NickName:   </p></td>
                <td><input type="text" id="Nickname"></td>
            </tr>
            <tr>
                <td><p>Macc Address:   </p></td>
                <td><p id="mac-address"></p></td>
            </tr>
            <tr>
                <td><p>Added at:   </p></td>
                <td> <input type="date" name="date-added" disabled id="Date-Add"></td>
            </tr>
            <tr>
                <td><p>Priority:   </p></td>
                <td>
                    <table id="prio-table">
                        <tr>
                            <td><input type="radio" name="prio" value="Essential">ess</td>
                            <td><input type="radio" name="prio" value="Nonessential">non-ess</td>
                        </tr>
                    </table>
                </td>
            </tr>
            <tr>
                <td>
                    <input type="button" value="remove-device" class="w3-button w3-red w3-round" onclick="DeleteDevice()" />
                </td>
                <td> <input type="button" value="approve" class="w3-button w3-blue w3-round" onclick="ChangeSettings()" /></td>
            </tr>
        </table>

    </div>


    <script>
        let username, PLUG;
        //let url = new URL(window.parent.$("#mainFrame").attr("src"));
        //let deviceMac = url.searchParams.get("mac");//BC:DD:C2:23:D6:60
        let deviceMac = "testPlugForRon";
        $(document).ready(function () {

            //USER = getUser("ron", "123123");//needed for testings
            //username = JSON.parse(sessionStorage.currentSmartSwitchUser);
            username = "avi";//sessionStorage.currentSmartSwitchUser
            getUserPlugs(username, function (plugs) {
                for (let i = 0; i < plugs.length; i++) {
                    if (plugs[i].mac == deviceMac) {
                        PLUG = plugs[i];//linking the plug we are working on
                        break;
                    }
                }

                let $currentNickname = PLUG.nickname;
                $("#Nickname").attr("placeholder", $currentNickname)
                $("#mac-address").text(deviceMac);               
                $("#Date-Add").val(formatDate(PLUG.addedAt));
            })

        });

        function formatDate(date) {
            let month = (date.getMonth() + 1) <= 9 ? '0' + (date.getMonth() + 1) : date.getMonth() + 1;
            let day = date.getDay() <= 9 ? '0' + date.getDay() : date.getDay();
            return date.getFullYear() + '-' + month + '-' + day;
        }

        function DeleteDevice() {
            denyPlug(PLUG.mac, function () {
                PLUG.remove();//delete device from user.plugs
                parent.openPage("PlugMainViewer");//go to PlugMainViewer page after deleting
            })

           
        }
        function ChangeSettings() {           

            let priorityString = $("input[name='prio']:checked").val();
            let priorityToSend;
            if (priorityString === "Essential") priorityToSend = Priorities.Essential;
            else priorityToSend = Priorities.Nonessential;

            let plugProperties = {
                "mac": PLUG.mac,
                "nickname": $("#Nickname").val(),
                "priority": priorityToSend
            };


            updatePlug(plugProperties, function () {
                PLUG.nickname = $("#Nickname").val();
                $("#Nickname").attr("placeholder", $("#Nickname").val())
                PLUG.priority = $("input[name='prio']:checked").val();
            })  

        }

    </script>

</body>
</html>
