<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title></title>
    <style>
        .device-div {
            border: 1px solid black;
            height: 100px;
            margin-bottom: 10px;
        }

        .device-circle {
            border: 1px solid gray;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            margin-left: 20px;
            margin-top: 20px;
            display: inline-block;
        }

        .device-name {
            color: red;
            vertical-align: middle;
        }
    </style>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script>
        let devices = [];

        function createList() {
            for (let i = 0; i < devices.length; i++) {
                let $deviceDiv = $("<div>").addClass("device-div");
                let $deviceCircle = $("<div>")
                    .addClass("device-circle")
                    .click(function () {
                        let color = $(this).css("background-color");
                        let nextColor = color == "rgba(0, 0, 0, 0)" ? "rgba(0, 0, 255, 0.4)" : "rgba(0, 0, 0, 0)";
                        $(this).css("background-color", nextColor);
                    })
                    .css("background-color", devices[i].isOn ? "rgba(0, 0, 255, 0.4)" : "rgba(0, 0, 0, 0)");
                $deviceDiv
                    .append($deviceCircle)
                    .append($("<span>").text(devices[i].name).addClass("device-name"));
                $("body").append($deviceDiv);
            }
        }

        function getFromDb() {
            $("input").remove();
            $.get("https://smartswitch.conveyor.cloud/api/values", function (data) {

                for (let i = 0; i < data.length; i++) {
                    console.log(data[i]);
                    let json = JSON.parse(data[i]);
                    console.log(json);
                    let newDevice = { name: json.Nickname, isOn: json.IsOn };

                    devices.push(newDevice);
                }

                createList();
            })
        }
        
    </script>
</head>
<body>
    <h1 style="text-align: center">SmartSwitchDemo</h1>
    <input type="button" value="load plugs from database" onclick="getFromDb()" />
</body>
</html>